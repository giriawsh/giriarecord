<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第一章 Node简介 | Girecord</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/pencil.png">
    <meta name="description" content="Giria的学习记录">
    <link rel="preload" href="/assets/css/0.styles.a748b10c.css" as="style"><link rel="preload" href="/assets/js/app.d811c258.js" as="script"><link rel="preload" href="/assets/js/2.b0d06978.js" as="script"><link rel="preload" href="/assets/js/18.9f5cd19a.js" as="script"><link rel="prefetch" href="/assets/js/10.c058f302.js"><link rel="prefetch" href="/assets/js/11.8dd384d0.js"><link rel="prefetch" href="/assets/js/12.a57db71e.js"><link rel="prefetch" href="/assets/js/13.ba28784c.js"><link rel="prefetch" href="/assets/js/14.c932930e.js"><link rel="prefetch" href="/assets/js/15.214d63a1.js"><link rel="prefetch" href="/assets/js/16.d7b01f05.js"><link rel="prefetch" href="/assets/js/17.d86602f8.js"><link rel="prefetch" href="/assets/js/19.7fd1e862.js"><link rel="prefetch" href="/assets/js/20.d65b214c.js"><link rel="prefetch" href="/assets/js/21.1b73581a.js"><link rel="prefetch" href="/assets/js/22.a1991fce.js"><link rel="prefetch" href="/assets/js/23.86ad9e68.js"><link rel="prefetch" href="/assets/js/24.65381257.js"><link rel="prefetch" href="/assets/js/25.7bd935b2.js"><link rel="prefetch" href="/assets/js/26.32e3f54b.js"><link rel="prefetch" href="/assets/js/27.4b8a459a.js"><link rel="prefetch" href="/assets/js/28.8fbb372e.js"><link rel="prefetch" href="/assets/js/29.14d35dd5.js"><link rel="prefetch" href="/assets/js/3.2e07bdbd.js"><link rel="prefetch" href="/assets/js/30.836a9de2.js"><link rel="prefetch" href="/assets/js/31.557cf90d.js"><link rel="prefetch" href="/assets/js/32.9cb9ce1c.js"><link rel="prefetch" href="/assets/js/33.75bed696.js"><link rel="prefetch" href="/assets/js/34.62b0841c.js"><link rel="prefetch" href="/assets/js/35.ddeecc7e.js"><link rel="prefetch" href="/assets/js/36.dda463c4.js"><link rel="prefetch" href="/assets/js/37.16b89d36.js"><link rel="prefetch" href="/assets/js/38.b10e01fe.js"><link rel="prefetch" href="/assets/js/39.0c104c50.js"><link rel="prefetch" href="/assets/js/4.35c41ba6.js"><link rel="prefetch" href="/assets/js/40.f0cb89f5.js"><link rel="prefetch" href="/assets/js/41.480570b4.js"><link rel="prefetch" href="/assets/js/42.08b42bef.js"><link rel="prefetch" href="/assets/js/43.8d61e275.js"><link rel="prefetch" href="/assets/js/44.b8e43077.js"><link rel="prefetch" href="/assets/js/45.54d487f1.js"><link rel="prefetch" href="/assets/js/46.5a382eae.js"><link rel="prefetch" href="/assets/js/47.1f8796a9.js"><link rel="prefetch" href="/assets/js/48.8d46e23a.js"><link rel="prefetch" href="/assets/js/49.72b8ca20.js"><link rel="prefetch" href="/assets/js/5.7b10027c.js"><link rel="prefetch" href="/assets/js/50.b2344657.js"><link rel="prefetch" href="/assets/js/51.080a56f5.js"><link rel="prefetch" href="/assets/js/52.bad7a065.js"><link rel="prefetch" href="/assets/js/53.ad9bdcfd.js"><link rel="prefetch" href="/assets/js/54.6770d917.js"><link rel="prefetch" href="/assets/js/55.c0172ecd.js"><link rel="prefetch" href="/assets/js/56.49c919d4.js"><link rel="prefetch" href="/assets/js/57.1767b53b.js"><link rel="prefetch" href="/assets/js/58.41eeaa28.js"><link rel="prefetch" href="/assets/js/59.64f20b7f.js"><link rel="prefetch" href="/assets/js/6.5964ef22.js"><link rel="prefetch" href="/assets/js/60.0f75477a.js"><link rel="prefetch" href="/assets/js/61.4be6c4a4.js"><link rel="prefetch" href="/assets/js/62.e5d06d6d.js"><link rel="prefetch" href="/assets/js/63.955d4114.js"><link rel="prefetch" href="/assets/js/64.d3e90038.js"><link rel="prefetch" href="/assets/js/65.e8997251.js"><link rel="prefetch" href="/assets/js/66.e43a4e42.js"><link rel="prefetch" href="/assets/js/67.178746ff.js"><link rel="prefetch" href="/assets/js/68.8b74209e.js"><link rel="prefetch" href="/assets/js/69.cd787813.js"><link rel="prefetch" href="/assets/js/7.a1320352.js"><link rel="prefetch" href="/assets/js/70.51f9e21c.js"><link rel="prefetch" href="/assets/js/71.e52c53ad.js"><link rel="prefetch" href="/assets/js/72.48ee5f30.js"><link rel="prefetch" href="/assets/js/73.d271fa49.js"><link rel="prefetch" href="/assets/js/74.a6baf45f.js"><link rel="prefetch" href="/assets/js/75.096cf42e.js"><link rel="prefetch" href="/assets/js/76.a2318a27.js"><link rel="prefetch" href="/assets/js/8.6a3c595d.js"><link rel="prefetch" href="/assets/js/9.586c950f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a748b10c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Girecord</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码学习" class="dropdown-title"><span class="title">源码学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码学习" class="mobile-dropdown-title"><span class="title">源码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/source/element/" class="nav-link">
  Element UI
</a></li><li class="dropdown-item"><!----> <a href="/source/vue/" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="书籍学习" class="dropdown-title"><span class="title">书籍学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="书籍学习" class="mobile-dropdown-title"><span class="title">书籍学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/books/theDefinitiveGuideToJavaScript/" class="nav-link">
  JavaScript权威指南
</a></li><li class="dropdown-item"><!----> <a href="/books/theNodeBeginnerBook/" class="nav-link">
  NodeJS入门
</a></li><li class="dropdown-item"><!----> <a href="/books/diveIntoNode/" class="nav-link router-link-active">
  深入浅出Node.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法学习" class="dropdown-title"><span class="title">算法学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法学习" class="mobile-dropdown-title"><span class="title">算法学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/codingInterviews/" class="nav-link">
  剑指Offer系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文学习" class="dropdown-title"><span class="title">博文学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文学习" class="mobile-dropdown-title"><span class="title">博文学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/postsLearning/collect/" class="nav-link">
  博文收集
</a></li><li class="dropdown-item"><!----> <a href="/postsLearning/2020/" class="nav-link">
  2020年
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端相关" class="dropdown-title"><span class="title">前端相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端相关" class="mobile-dropdown-title"><span class="title">前端相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS库相关
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe/nodejs/" class="nav-link">
  Node.js
</a></li><li class="dropdown-subitem"><a href="/fe/vuejs/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/fe/reactjs/" class="nav-link">
  React.js
</a></li><li class="dropdown-subitem"><a href="/fe/reactjs/" class="nav-link">
  AJAX
</a></li><li class="dropdown-subitem"><a href="/fe/svgjs/" class="nav-link">
  SVG.js
</a></li></ul></li><li class="dropdown-item"><h4>
          框架相关
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe/nuxtjs/" class="nav-link">
  Nuxt框架
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/application/" class="nav-link">
  志愿填报建议
</a></li></ul></div></div><div class="nav-item"><a href="https://www.giriawsh.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人文章
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码学习" class="dropdown-title"><span class="title">源码学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码学习" class="mobile-dropdown-title"><span class="title">源码学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/source/element/" class="nav-link">
  Element UI
</a></li><li class="dropdown-item"><!----> <a href="/source/vue/" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="书籍学习" class="dropdown-title"><span class="title">书籍学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="书籍学习" class="mobile-dropdown-title"><span class="title">书籍学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/books/theDefinitiveGuideToJavaScript/" class="nav-link">
  JavaScript权威指南
</a></li><li class="dropdown-item"><!----> <a href="/books/theNodeBeginnerBook/" class="nav-link">
  NodeJS入门
</a></li><li class="dropdown-item"><!----> <a href="/books/diveIntoNode/" class="nav-link router-link-active">
  深入浅出Node.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法学习" class="dropdown-title"><span class="title">算法学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法学习" class="mobile-dropdown-title"><span class="title">算法学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/codingInterviews/" class="nav-link">
  剑指Offer系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文学习" class="dropdown-title"><span class="title">博文学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文学习" class="mobile-dropdown-title"><span class="title">博文学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/postsLearning/collect/" class="nav-link">
  博文收集
</a></li><li class="dropdown-item"><!----> <a href="/postsLearning/2020/" class="nav-link">
  2020年
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端相关" class="dropdown-title"><span class="title">前端相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端相关" class="mobile-dropdown-title"><span class="title">前端相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          JS库相关
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe/nodejs/" class="nav-link">
  Node.js
</a></li><li class="dropdown-subitem"><a href="/fe/vuejs/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/fe/reactjs/" class="nav-link">
  React.js
</a></li><li class="dropdown-subitem"><a href="/fe/reactjs/" class="nav-link">
  AJAX
</a></li><li class="dropdown-subitem"><a href="/fe/svgjs/" class="nav-link">
  SVG.js
</a></li></ul></li><li class="dropdown-item"><h4>
          框架相关
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/fe/nuxtjs/" class="nav-link">
  Nuxt框架
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/application/" class="nav-link">
  志愿填报建议
</a></li></ul></div></div><div class="nav-item"><a href="https://www.giriawsh.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人文章
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>深入浅出Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html" aria-current="page" class="active sidebar-link">第一章 Node简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#node给js带来的意义" class="sidebar-link">Node给JS带来的意义</a></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#node的特点" class="sidebar-link">Node的特点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#_1-异步i-o" class="sidebar-link">1. 异步I/O</a></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#_2-事件与回调函数" class="sidebar-link">2. 事件与回调函数</a></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#_3-单线程" class="sidebar-link">3. 单线程</a></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#_4-跨平台" class="sidebar-link">4. 跨平台</a></li></ul></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#node的应用场景" class="sidebar-link">Node的应用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#_1-i-o密集型" class="sidebar-link">1. I/O密集型</a></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#_2-是否不擅长cpu密集型业务" class="sidebar-link">2. 是否不擅长CPU密集型业务</a></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#_3-与遗留系统和平共处" class="sidebar-link">3. 与遗留系统和平共处</a></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#_4-分布式应用" class="sidebar-link">4. 分布式应用</a></li></ul></li><li class="sidebar-sub-header"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-yi-zhang-node-jian-jie.html#node的使用者" class="sidebar-link">Node的使用者</a></li></ul></li><li><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-er-zhang-mo-kuai-ji-zhi.html" class="sidebar-link">第二章 模块机制</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第一章-node简介"><a href="#第一章-node简介" class="header-anchor">#</a> 第一章 Node简介</h1> <h2 id="node给js带来的意义"><a href="#node给js带来的意义" class="header-anchor">#</a> Node给JS带来的意义</h2> <p>Chrome浏览器和Node的组件构成：</p> <p><img src="https://giriawsh-bucket.oss-cn-beijing.aliyuncs.com/img/20201202184605.png" alt="image-20201202184558332"></p> <p>浏览器中除了V8作为JS引擎外，还有一个WebKit布局引擎。对于前端浏览器的发展现状而言，HTML5标准统一的过程是相当缓慢的，JS长久以来限制在浏览器的沙箱中运行，它的能力取决于浏览器中间层提供的支持有多少。</p> <p>除了HTML、WebKit、显卡这些UI技术没有支持外，Node和结构与Chrome十分相似。它们都是基于事件驱动的异步架构：浏览器通过事件驱动来服务界面上的交互，Node通过事件驱动来服务I/O。</p> <p>Node打破了过去JS只能在浏览器中运行的局面，前后端编程环境同一，可以大大降低前后端转换所需要的上下文交换代价。</p> <blockquote><p><img src="https://giriawsh-bucket.oss-cn-beijing.aliyuncs.com/img/20201202185023.png" alt="image-20201202185022954"></p></blockquote> <h2 id="node的特点"><a href="#node的特点" class="header-anchor">#</a> Node的特点</h2> <h3 id="_1-异步i-o"><a href="#_1-异步i-o" class="header-anchor">#</a> 1. 异步I/O</h3> <p>比较熟悉的是发起Ajax调用请求：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/url'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>title<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;收到响应&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;发送Ajax结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// =&gt; </span>
发送Ajax结束
收到响应
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>调用<code>$.post()</code>后，后续代码是被立即执行的，而“收到响应”的执行时间是不被预期的。</p> <p>我们只能知道它将在这个异步请求结束后执行，但并不知道具体的时间点。</p> <p>异步调用中对于结果值得捕获符合<u>“Don't call me, I will call you”</u>原则。注重结果，不关心过程。</p> <p>经典Ajax调用过程如下：</p> <p><img src="https://giriawsh-bucket.oss-cn-beijing.aliyuncs.com/img/image-20201207233246342.png" alt="image-20201207233246342"></p> <p>在Node中，异步I/O也很常见。以读取文件为例，我们可以看到它与前端Ajax调用的方式是极其类似的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span>  fs  <span class="token operator">=</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/path'</span><span class="token punctuation">,</span>  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>  file</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件完成'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发起读取文件'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这里的“发起读取文件&quot;是在“读取文件完成&quot;之前输出的。同样，“读取文件完成&quot;的执行也取决于读取文件的异步调用何时结束。</p> <p>Node中的经典调用周期如下：</p> <p><img src="https://giriawsh-bucket.oss-cn-beijing.aliyuncs.com/img/image-20201207233535373.png" alt="image-20201207233535373"></p> <p>在Node中，绝大多数的操作都以异步的方式进行调用。</p> <p>在Node中，我们可以从语言层面很自然地<strong>进行并行I/O操作</strong>。每个调用之间无须等待之前的I/O调用结束。</p> <p>下面的两个文件读取任务的耗时<u>取决于最慢的那个文件读取的耗时</u>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/path1'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件1完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/path2'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件2完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>而对于同步I/O而言，它们的耗时是两个任务的耗时之和。</p> <h3 id="_2-事件与回调函数"><a href="#_2-事件与回调函数" class="header-anchor">#</a> 2. 事件与回调函数</h3> <p>在JS中，事件机制得到了广泛的应用。Node将前端浏览器中应用广泛且成熟的事件引入后端， 配合异步I/O，将事件点暴露给业务逻辑。</p> <p>下面的例子展示的是Ajax异步提交的服务器端处理过程。</p> <p>Node创建一个Web服务器，并侦听8080端口。对于服务器，我们为其绑定了<u>request事件</u>，对于请求对象，我们为其绑定了<u>data事件和end事件</u>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 侦听服务器的request事件</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">var</span> postData <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> 
    req<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 侦听请求的data事件</span>
	req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">trunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> postData <span class="token operator">+=</span> trunk<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 侦听请求的end事件</span>
	req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器启动完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>相应在前端Ajax请求绑定success事件，发出请求后，只需关心请求成功时执行的相应业务逻辑（success匿名函数）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'url'</span><span class="token operator">:</span> <span class="token string">'/url'</span><span class="token punctuation">,</span>
    <span class="token string">'method'</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token string">'data'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'success'</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// success事件</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>事件编程方式具有<strong>轻量级、松耦合、只关注事务点</strong>等优势。但是在多个异步任务的场景下，事件与事件之间<strong>各自独立，如何协作</strong>是一个问题。</p> <p>回调函数无处不在，因为在JS中函数时第一等公民，可以将函数作为对象传递给方法作为实参进行调用。</p> <p>Node除了异步和事件外，回调函数是一大特色。纵观下来，回调函数也是最好的<u>接受异步调用返回数据</u>的方式。</p> <p>代码的<u>编写顺序与执行顺序并无关系</u>，这可能造成阅读上的障碍。在流程控制方面，因为穿插了异步方法和回调函数，与常规的同步方式相比，变得不那么一目了然了。</p> <h3 id="_3-单线程"><a href="#_3-单线程" class="header-anchor">#</a> 3. 单线程</h3> <p>Node保持了JavaScript在浏览器中单线程的特点。而且在Node中，JavaScript与其余线程是<strong>无法共享任何状态</strong>的。</p> <p>单线程的最大好处是不用像多线程编程那样处处在意状态的同步问题，这里<u>没有死锁的存在</u>，<u>也没有线程上下文交换</u>所带来的性能上的开销。</p> <p>同样，单线程也有它自身的弱点，单线程的弱点具体有以下3方面：</p> <ul><li>无法利用多核CPU。</li> <li>错误会引起整个应用退出，应用的健壮性值得考验。</li> <li>大量计算占用CPU导致无法继续调用异步I/O。</li></ul> <p>浏览器中JS与UI共用一个线程，JS长时间执行会导致UI的渲染和响应被中断。</p> <p>在Node中，长时间的CPU占用也会导致后续的异步I/O无法调用，已完成的异步I/O的回调函数也会得不到及时执行。</p> <blockquote><p><img src="https://giriawsh-bucket.oss-cn-beijing.aliyuncs.com/img/image-20201207235651922.png" alt="image-20201207235651922"></p></blockquote> <p>Node采用了与Web Worker相同的思路来解决单线程中大计算量的问题：<strong>child_process</strong></p> <p>子进程的出现，意味着Node可以从容地应对单线程在健壮性和无法利用多核CPU方面的问题。</p> <p>通过将计算分发到各个子进程，可以将大量计算分解掉，然后再<u>通过进程之间的事件消息</u>来传递结果，这可以很好地保持应用模型的简单和低依赖。</p> <p>通过<strong>Master-Worker</strong>的管理方式，也可以很好地管理各个工作进程，以达到更高的健壮性。</p> <h3 id="_4-跨平台"><a href="#_4-跨平台" class="header-anchor">#</a> 4. 跨平台</h3> <p>起初Node只能在Linux平台上运行，Windows上只能借助于Cygwin或者MingGW。现在Node已经可以直接在Windows平台上运行了。</p> <p><img src="https://giriawsh-bucket.oss-cn-beijing.aliyuncs.com/img/image-20201207235956977.png" alt="image-20201207235956977"></p> <blockquote><p>兼容Windows和*nix平台主要得益于Node在架构层面的改动，它在操作系统与Node上层模块系统之间构建了一层<strong>平台层架构</strong>，即<strong>libuv</strong>。目前，libuv已经成为许多系统实现跨平台的基础组件。</p> <p>通过良好的架构，Node的第三方C++模块也可以借助libuv实现跨平台。目前，除了没有保持更新的C++模块外，大部分C++模块都能实现跨平台的兼容。</p></blockquote> <h2 id="node的应用场景"><a href="#node的应用场景" class="header-anchor">#</a> Node的应用场景</h2> <p>关于Node，探讨得较多的主要有I/O密集型和CPU密集型。</p> <div class="custom-block tip"><p class="custom-block-title">CPU密集型和I/O密集型是什么</p> <p><a href="https://zhuanlan.zhihu.com/p/62766037" target="_blank" rel="noopener noreferrer">参考文章<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li><strong>CPU密集型（CPU-bound）</strong></li></ul> <p>CPU密集型也叫计算密集型，指的是系统的硬盘、内存性能相对CPU要好很多，此时，系统运作大部分的状况是CPU Loading 100%，CPU要读/写I/O(硬盘/内存)，I/O在很短的时间就可以完成，而CPU还有许多运算要处理，CPU Loading很高。</p> <p>在多重程序系统中，大部份时间用来做计算、逻辑判断等CPU动作的程序称之CPU bound。例如一个计算圆周率至小数点一千位以下的程序，在执行的过程当中绝大部份时间用在三角函数和开根号的计算，便是属于CPU bound的程序。</p> <p>CPU bound的程序一般而言CPU占用率相当高。这可能是因为任务本身不太需要访问I/O设备，也可能是因为程序是多线程实现因此屏蔽掉了等待I/O的时间。</p> <ul><li><strong>IO密集型（I/O bound）</strong></li></ul> <p>IO密集型指的是系统的CPU性能相对硬盘、内存要好很多，此时，系统运作，大部分的状况是CPU在等I/O (硬盘/内存) 的读/写操作，此时CPU Loading并不高。</p> <p>I/O bound的程序一般在达到性能极限时，CPU占用率仍然较低。这可能是因为任务本身需要大量I/O操作，而pipeline做得不是很好，没有充分利用处理器能力。</p> <p>IO密集型任务执行期间，99%的时间都花在IO上，花在CPU上的时间很少，因此，用运行速度极快的C语言替换用Python这样运行速度极低的脚本语言，完全无法提升运行效率。对于IO密集型任务，最合适的语言就是开发效率最高（代码量最少）的语言，脚本语言是首选，C语言最差。</p> <p>总之，计算密集型程序适合C语言多线程，I/O密集型适合脚本语言开发的多线程。</p></div> <h3 id="_1-i-o密集型"><a href="#_1-i-o密集型" class="header-anchor">#</a> 1. I/O密集型</h3> <p>Node面向网络且擅长并行I/O，能够有效地组织起更多的硬件资源，从而提供更多好的服务。</p> <p>I/O密集的优势：Node利用<strong>事件循环</strong>的处理能力，而不是启动每一个线程为每一个请求服务，资源占用极少。</p> <h3 id="_2-是否不擅长cpu密集型业务"><a href="#_2-是否不擅长cpu密集型业务" class="header-anchor">#</a> 2. 是否不擅长CPU密集型业务</h3> <p>实际上V8的执行效率是十分高的。对比于C和Go语言（静态语言），Node是足够高效的，它优秀的运算能力主要来自V8的深度性能优化。</p> <p><img src="https://giriawsh-bucket.oss-cn-beijing.aliyuncs.com/img/image-20201212202418682.png" alt="image-20201212202418682"></p> <p>CPU密集型应用给Node 带来的挑战主要是：</p> <p>由于JavaScript单线程的原因，如果有长时间运行的计算（比如大循环），将会<u>导致CPU时间片不能释放，使得后续I/O无法发起。</u></p> <p>但是<strong>适当调整和分解大型运算任务为多个小任务</strong>，使得运算能够适时释放，不阻塞I/O调用的发起，这样既可同时享受到并行异步I/O的好处，又能充分利用CPU。</p> <p>关于CPU密集型应用，Node的<strong>异步I/O</strong>已经解决了在单线程上CPU与I/O之间阻塞无法重叠利用的问题，I/O阻塞造成的性能浪费远比CPU的影响小。</p> <p>对于<u>长时间运行的计算</u>，如果它的耗时超过普通阻塞I/O的耗时，那么应用场景就需要重新评估，因为这类计算比阻塞I/O还影响效率，甚至说就是一个纯计算的场景，根本没有I/O。<u>此类应用场景或许应当采用多线程的方式进行计算。</u></p> <p>Node虽然没有提供多线程用于计算支持，但是还是有以下两个方式来充分利用CPU。</p> <ul><li><p>Node可以通过<strong>编写C/C++扩展的方式</strong>更高效地利用CPU，将一些V8不能做到性能极致的地方通过C/C++来实现。</p></li> <li><p>如果单线程的Node不能满足需求，甚至用了C/C++扩展后还觉得不够，那么<strong>通过子进程的方式</strong>，将一部分Node进程当做常驻服务进程用于计算，然后利用进程间的消息来传递结果，将计算与I/O分离，这样还能充分利用多CPU。</p></li></ul> <p>CPU密集不可怕，如何合理调度是诀窍。</p> <h3 id="_3-与遗留系统和平共处"><a href="#_3-与遗留系统和平共处" class="header-anchor">#</a> 3. 与遗留系统和平共处</h3> <p>在Web端，过去大多都是同步的方式编写的程序，这种串行调用下层应用数据的过程中充斥着串行的等待时间。</p> <p>如果采用多线程来解决这种串行等待，又或多或少地显得小题大作。在Node 中，语言层面即可天然并行的特性在这种场景中显得十分有效。对于已有的稳定系统，并非意味着我们要抛弃掉。</p> <blockquote><p>LinkedIn在他们的移动版网站上的实践非常典型地说明了这个问题。旧有的系统具有非常稳定的数据输出，持续为传统网站服务，同时为移动版提供数据源，Node将该数据源当做数据接口， 发挥异步并行的优势，而不用关心它背后是用什么语言实现的。</p> <p>这方面，国内的雪球财经也有很好的实践。雪球财经是从旧有的Java项目中分离出一个子项目，在这个子项目中，没有继续采用Java/JSP而是采用Node来完成Web端的开发，使得前端工程师在HTTP协议栈的两端能够高效灵活地开发，避免了Java烦琐的表达；另一方面，又利用Java 作为后端接口和中间件，使其具有良好的稳定性。两者互相结合，取长补短。</p></blockquote> <h3 id="_4-分布式应用"><a href="#_4-分布式应用" class="header-anchor">#</a> 4. 分布式应用</h3> <p>分布式应用意味着可伸缩性的要求非常高。</p> <p>Node高效利用并行I/O的过程，也是高效使用数据库的过程。对于Node，这个行为只是一次普通的I/O，对于分布式数据库而言，却是一次复杂的计算，所以也是进而充分压榨硬件资源的过程。</p> <h2 id="node的使用者"><a href="#node的使用者" class="header-anchor">#</a> Node的使用者</h2> <ul><li><p>**前后端编程口言环境统一。**这类倚重点的代表是雅虎。雅虎开放了Cocktail框架，利用自己深厚的前端沉淀，将YUI3这个前端框架的能力借助Node延伸到服务器端，使得使用者摆脱了H常工作中一边写JavaScript一边写PHP所带来的上下文交换负担。</p></li> <li><p>**Node带来的高性能I/O用于实时应用。**Voxer将Node应用在实时语音上。国内腾讯的朋友网将Node应用在长连接中，以提供实时功能，花瓣网、蘑菇街等公司通过socket.io实现实时通知的功能。</p></li> <li><p>**并行I/O使得使用者可以更高效地利用分布式环境。**阿里巴巴和eBay是这方面的典型。阿里巴巴的NodeFox和eBay的ql.io都是借用Node并行I/O的能力，更高效地使用已有的数据。</p></li> <li><p>**并行I/O,有效利用稳定接口提升Web渲染能力。**雪球财经和LinkedIn的移动版网站均是这种案例，撇弃同步等待式的顺序请求，大胆采用并行I/O，加速数据的获取进而提升Web 的渲染速度。</p></li> <li><p>**云计算平台提供Node支持。**微软将Node引入Azure的开发中，阿里云、百度均纷纷在云服务器上提供Node应用托管服务，Joyent更是云计算中提供Node支持的代表。这类平台看重JavaScript带来的开发上的优势，以及低资源占用、高性能的特点。</p></li> <li><p>**游戏开发领域。**游戏领域对实时和并发有很高的要求，网易开源了pomelo实时框架，可以应用在游戏和高实时应用中。</p></li> <li><p>**工具类应用。**过去依赖Java或其他语言构建的前端工具类应用，纷纷被一些前端工程师用Node重写，用前端熟悉的语言为前端构建熟悉的工具。</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/books/diveIntoNode/lesslessshen-ru-qian-chu-nodejsgreatergreater-di-er-zhang-mo-kuai-ji-zhi.html">
        第二章 模块机制
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d811c258.js" defer></script><script src="/assets/js/2.b0d06978.js" defer></script><script src="/assets/js/18.9f5cd19a.js" defer></script>
  </body>
</html>
