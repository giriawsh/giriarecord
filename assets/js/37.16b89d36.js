(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{386:function(s,a,n){"use strict";n.r(a);var e=n(42),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"代码的组织和部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码的组织和部署"}},[s._v("#")]),s._v(" 代码的组织和部署")]),s._v(" "),n("p",[s._v("使用NodeJS编写程序前，为了有个良好的开端，首先需要准备好代码的目录结构和部署方式。")]),s._v(" "),n("h2",{attrs:{id:"模块路径解析规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模块路径解析规则"}},[s._v("#")]),s._v(" 模块路径解析规则")]),s._v(" "),n("p",[n("code",[s._v("require")]),s._v("函数支持斜杠（"),n("code",[s._v("/")]),s._v("）或盘符（"),n("code",[s._v("C:")]),s._v("）开头的绝对路径，也支持"),n("code",[s._v("./")]),s._v("开头的相对路径。但这两种路径在模块之间建立了强耦合关系，一旦某个模块文件的存放位置需要变更，使用该模块的其它模块的代码也需要跟着调整，变得牵一发动全身。")]),s._v(" "),n("p",[s._v("因此，"),n("code",[s._v("require")]),s._v("函数支持第三种形式的路径，写法类似于"),n("code",[s._v("foo/bar")]),s._v("，并依次按照以下规则解析路径，直到找到模块位置。")]),s._v(" "),n("ol",[n("li",[s._v("内置模块")])]),s._v(" "),n("p",[s._v("如果传递给"),n("code",[s._v("require")]),s._v("函数的是NodeJS内置模块名称，不做路径解析，直接返回内部模块的导出对象，例如"),n("code",[s._v("require('fs')")]),s._v("。")]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("node_modules目录")])]),s._v(" "),n("p",[s._v("NodeJS定义了一个特殊的"),n("code",[s._v("node_modules")]),s._v("目录用于存放模块。例如某个模块的绝对路径是"),n("code",[s._v("/home/user/hello.js")]),s._v("，在该模块中使用"),n("code",[s._v("require('foo/bar')")]),s._v("方式加载模块时，则NodeJS依次尝试使用以下路径。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" /home/user/node_modules/foo/bar\n /home/node_modules/foo/bar\n /node_modules/foo/bar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("NODE_PATH环境变量")])]),s._v(" "),n("p",[s._v("与PATH环境变量类似，NodeJS允许通过NODE_PATH环境变量来"),n("u",[s._v("指定额外的模块搜索路径")]),s._v("。")]),s._v(" "),n("p",[s._v("NODE_PATH环境变量中包含一到多个目录路径。路径之间在Linux下使用"),n("code",[s._v(":")]),s._v("分隔，在Windows下使用"),n("code",[s._v(";")]),s._v("分隔。")]),s._v(" "),n("p",[s._v("例如定义了以下NODE_PATH环境变量：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" NODE_PATH=/home/user/lib:/home/lib\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("当使用"),n("code",[s._v("require('foo/bar')")]),s._v("的方式加载模块时，则NodeJS依次尝试以下路径。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" /home/user/lib/foo/bar\n /home/lib/foo/bar\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"包-package"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#包-package"}},[s._v("#")]),s._v(" 包（package）")]),s._v(" "),n("p",[s._v("JS模块的基本单位是单个JS文件。")]),s._v(" "),n("p",[s._v("复杂些的模块往往由多个子模块组成。为了便于管理和使用，我们可以把"),n("u",[s._v("由多个子模块组成的大模块称做"),n("code",[s._v("包")]),s._v("，并把所有子模块放在同一个目录里。")])]),s._v(" "),n("p",[s._v("在组成一个包的所有子模块中，需要有一个"),n("strong",[s._v("入口模块")]),s._v("，"),n("u",[s._v("入口模块的导出对象被作为包的导出对象")]),s._v("。")]),s._v(" "),n("p",[s._v("例如有以下目录结构。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- /home/user/lib/\n    - cat/\n        head.js\n        body.js\n        main.js\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("其中"),n("code",[s._v("cat")]),s._v("目录定义了一个包，其中包含了3个子模块。"),n("code",[s._v("main.js")]),s._v("作为入口模块，其内容如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" head "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./head'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" body "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./body'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nexports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("create")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        head"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" head"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        body"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("在其它模块里使用包的时候，需要加载包的入口模块。")]),s._v(" "),n("p",[s._v("如果是上例，使用"),n("code",[s._v("require('/home/user/lib/cat/main')")]),s._v("能达到目的，但是"),n("u",[s._v("入口模块名称出现在路径里不是个好主意")]),s._v("。因此我们需要做点额外的工作，让包使用起来更像是单个模块。")]),s._v(" "),n("h3",{attrs:{id:"index-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#index-js"}},[s._v("#")]),s._v(" index.js")]),s._v(" "),n("p",[s._v("当模块的文件名是"),n("code",[s._v("index.js")]),s._v("，"),n("u",[s._v("加载模块时可以使用模块所在目录的路径代替模块文件路径")]),s._v("，因此接着上例，以下两条语句等价。")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" cat "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/user/lib/cat'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" cat "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/user/lib/cat/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这样处理后，"),n("u",[s._v("就只需要把包目录路径传递给"),n("code",[s._v("require")]),s._v("函数")]),s._v("，感觉上整个目录被当作单个模块使用，更有整体感。")]),s._v(" "),n("h3",{attrs:{id:"package-json"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#package-json"}},[s._v("#")]),s._v(" package.json")]),s._v(" "),n("p",[s._v("如果想"),n("u",[s._v("自定义入口模块的文件名和存放位置")]),s._v("，就需要在包目录下包含一个"),n("code",[s._v("package.json")]),s._v("文件，并在其中指定入口模块的路径。")]),s._v(" "),n("p",[s._v("上例中的"),n("code",[s._v("cat")]),s._v("模块可以重构如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" cat"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" doc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" lib"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n            head"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n            body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n            main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" tests"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("其中"),n("code",[s._v("package.json")]),s._v("内容如下。")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cat"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./lib/main.js"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("如此一来，就同样可以使用"),n("code",[s._v("require('/home/user/lib/cat')")]),s._v("的方式加载模块。NodeJS会根据包目录下的"),n("code",[s._v("package.json")]),s._v("找到入口模块所在位置。")]),s._v(" "),n("h2",{attrs:{id:"命令行程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令行程序"}},[s._v("#")]),s._v(" 命令行程序")]),s._v(" "),n("p",[s._v("使用NodeJS编写的东西，要么是一个包，要么是一个命令行程序，而前者最终也会用于开发后者。")]),s._v(" "),n("p",[s._v("我们在部署代码时需要一些技巧，让用户觉得自己是在使用一个命令行程序。")]),s._v(" "),n("p",[s._v("例如我们用NodeJS写了个程序，"),n("u",[s._v("可以把命令行参数原样打印出来")]),s._v("。")]),s._v(" "),n("p",[s._v("该程序很简单，在主模块内实现了所有功能。并且写好后，我们把该程序部署在"),n("code",[s._v("/home/user/bin/node-echo.js")]),s._v("这个位置。")]),s._v(" "),n("p",[s._v("为了在任何目录下都能运行该程序，我们需要使用以下终端命令。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ node /home/user/bin/node-echo.js Hello World\nHello World\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("这种使用方式看起来不怎么像是一个命令行程序，下边的才是我们期望的方式。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ node-echo Hello World\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"linux"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#linux"}},[s._v("#")]),s._v(" Linux")]),s._v(" "),n("p",[s._v("在Linux系统下，我们可以把JS文件当作shell脚本来运行，从而达到上述目的，具体步骤如下：")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("在shell脚本中，可以通过"),n("code",[s._v("#!")]),s._v("注释来指定当前脚本使用的解析器。所以我们首先在"),n("code",[s._v("node-echo.js")]),s._v("文件顶部增加以下一行注释，"),n("u",[s._v("表明当前脚本使用NodeJS解析")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" #! /usr/bin/env node\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("NodeJS会忽略掉位于JS模块首行的"),n("code",[s._v("#!")]),s._v("注释，不必担心这行注释是非法语句。")])]),s._v(" "),n("li",[n("p",[s._v("然后，我们使用以下命令赋予"),n("code",[s._v("node-echo.js")]),s._v("文件执行权限。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" $ chmod +x /home/user/bin/node-echo.js\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("最后，我们在PATH环境变量中指定的某个目录下，例如在"),n("code",[s._v("/usr/local/bin")]),s._v("下边创建一个软链文件，文件名与我们希望使用的终端命令同名，命令如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" $ sudo ln -s /home/user/bin/node-echo.js /usr/local/bin/node-echo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("p",[s._v("这样处理后，我们就可以在任何目录下使用"),n("code",[s._v("node-echo")]),s._v("命令了。")]),s._v(" "),n("h3",{attrs:{id:"windows"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[s._v("#")]),s._v(" Windows")]),s._v(" "),n("p",[s._v("在Windows系统下的做法完全不同，我们得靠"),n("code",[s._v(".cmd")]),s._v("文件来解决问题。假设"),n("code",[s._v("node-echo.js")]),s._v("存放在"),n("code",[s._v("C:\\Users\\user\\bin")]),s._v("目录，并且该目录已经添加到PATH环境变量里了。接下来需要在该目录下新建一个名为"),n("code",[s._v("node-echo.cmd")]),s._v("的文件，文件内容如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@node "C:\\User\\user\\bin\\node-echo.js" %*\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("这样处理后，我们就可以在任何目录下使用"),n("code",[s._v("node-echo")]),s._v("命令了。")]),s._v(" "),n("h2",{attrs:{id:"工程目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#工程目录"}},[s._v("#")]),s._v(" 工程目录")]),s._v(" "),n("p",[s._v("以编写一个命令行程序为例，一般我们会同时提供"),n("strong",[s._v("命令行模式和API模式")]),s._v("两种使用方式，并且我们会借助三方包来编写代码。")]),s._v(" "),n("p",[s._v("除了代码外，一个完整的程序也应该有自己的文档和测试用例。因此，一个标准的工程目录都看起来像下边这样。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- /home/user/workspace/node-echo/   # 工程目录\n    - bin/                          # 存放命令行相关代码\n        node-echo\n    + doc/                          # 存放文档\n    - lib/                          # 存放API相关代码\n        echo.js\n    - node_modules/                 # 存放三方包\n        + argv/\n    + tests/                        # 存放测试用例\n    package.json                    # 元数据文件\n    README.md                       # 说明文件\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("其中部分文件内容如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* bin/node-echo */")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" argv "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'argv'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    echo "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'../lib/echo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("echo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* lib/echo.js */")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("message")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* package.json */")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-echo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./lib/echo.js"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("以上例子中分类存放了不同类型的文件，并通过"),n("code",[s._v("node_moudles")]),s._v("目录直接使用三方包名加载模块。此外，定义了"),n("code",[s._v("package.json")]),s._v("之后，"),n("code",[s._v("node-echo")]),s._v("目录也可被当作一个包来使用。")]),s._v(" "),n("h2",{attrs:{id:"npm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm"}},[s._v("#")]),s._v(" NPM")]),s._v(" "),n("p",[s._v("NPM是随同NodeJS一起安装的包管理工具，能解决NodeJS代码部署上的很多问题，常见的使用场景有以下几种：")]),s._v(" "),n("ul",[n("li",[s._v("允许用户从NPM服务器下载别人编写的三方包到本地使用。")]),s._v(" "),n("li",[s._v("允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。")]),s._v(" "),n("li",[s._v("允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。")])]),s._v(" "),n("h3",{attrs:{id:"下载三方包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#下载三方包"}},[s._v("#")]),s._v(" 下载三方包")]),s._v(" "),n("p",[s._v("需要使用三方包时，首先得知道有哪些包可用。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://npmjs.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("npmjs.org"),n("OutboundLink")],1),s._v("提供了个搜索框可以根据包名来搜索，但如果连想使用的三方包的名字都不确定的话，就请百度一下吧。")]),s._v(" "),n("p",[s._v("知道了包名后，比如上边例子中的"),n("code",[s._v("argv")]),s._v("，就可以在工程目录下打开终端，使用以下命令来下载三方包。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" argv\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nargv@0.0.2 node_modules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("argv\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("下载好之后，"),n("code",[s._v("argv")]),s._v("包就放在了工程目录下的"),n("code",[s._v("node_modules")]),s._v("目录中，因此在代码中只需要通过"),n("code",[s._v("require('argv')")]),s._v("的方式就好，无需指定三方包路径。")]),s._v(" "),n("p",[s._v("以上命令默认下载最新版三方包，如果想要下载指定版本的话，可以在包名后边加上"),n("code",[s._v("@<version>")]),s._v("，例如通过以下命令可下载0.0.1版的"),n("code",[s._v("argv")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" argv@0.0.1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nargv@0.0.1 node_modules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("argv\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("NPM对"),n("code",[s._v("package.json")]),s._v("的字段做了扩展，允许在其中申明三方包依赖，用于多个三方包的下载。因此，上边例子中的"),n("code",[s._v("package.json")]),s._v("可以改写如下：")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-echo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./lib/echo.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"argv"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.2"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("这样处理后，在工程目录下就可以使用"),n("code",[s._v("npm install")]),s._v("命令批量安装三方包了。")]),s._v(" "),n("p",[s._v("更重要的是，当以后"),n("code",[s._v("node-echo")]),s._v("也上传到了NPM服务器，别人下载这个包时，NPM会根据包中申明的三方包依赖自动下载进一步依赖的三方包。例如，使用"),n("code",[s._v("npm install node-echo")]),s._v("命令时，NPM会自动创建以下目录结构。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- project/\n    - node_modules/\n        - node-echo/\n            - node_modules/\n                + argv/\n            ...\n    ...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("如此一来，用户只需关心自己直接使用的三方包，不需要自己去解决所有包的依赖关系。因此建议写明在"),n("code",[s._v("package.json")]),s._v("文件中。")]),s._v(" "),n("h3",{attrs:{id:"安装命令行程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装命令行程序"}},[s._v("#")]),s._v(" 安装命令行程序")]),s._v(" "),n("p",[s._v("从NPM服务上下载安装一个命令行程序的方法与三方包类似。")]),s._v(" "),n("p",[s._v("例如上例中的"),n("code",[s._v("node-echo")]),s._v("提供了命令行使用方式，只要"),n("code",[s._v("node-echo")]),s._v("自己配置好了相关的"),n("code",[s._v("package.json")]),s._v("字段，对于用户而言，只需要使用以下命令安装程序。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" node-echo -g\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("参数中的"),n("code",[s._v("-g")]),s._v("表示全局安装，因此"),n("code",[s._v("node-echo")]),s._v("会默认安装到以下位置，并且"),n("u",[s._v("NPM会自动创建好Linux系统下需要的软链文件或Windows系统下需要的"),n("code",[s._v(".cmd")]),s._v("文件。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- /usr/local/               # Linux系统下\n    - lib/node_modules/\n        + node-echo/\n        ...\n    - bin/\n        node-echo\n        ...\n    ...\n\n- %APPDATA%\\npm\\            # Windows系统下\n    - node_modules\\\n        + node-echo\\\n        ...\n    node-echo.cmd\n    ...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"发布代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布代码"}},[s._v("#")]),s._v(" 发布代码")]),s._v(" "),n("p",[s._v("第一次使用NPM发布代码前需要注册一个账号。终端下运行"),n("code",[s._v("npm adduser")]),s._v("，之后按照提示做即可。")]),s._v(" "),n("p",[s._v("账号搞定后，接着我们需要编辑"),n("code",[s._v("package.json")]),s._v("文件，加入NPM必需的字段。接着上边"),n("code",[s._v("node-echo")]),s._v("的例子，"),n("code",[s._v("package.json")]),s._v("里必要的字段如下。")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-echo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("           # 包名，在NPM服务器上须要保持唯一\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("            # 当前版本号\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("              # 三方包依赖，需要指定包名和版本号\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"argv"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.2"')]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./lib/echo.js"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("       # 入口模块位置\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"bin"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"node-echo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./bin/node-echo"')]),s._v("      # 命令行程序名和主模块位置\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("之后，我们就可以在"),n("code",[s._v("package.json")]),s._v("所在目录下运行"),n("code",[s._v("npm publish")]),s._v("发布代码了。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("关于发布的新手问题")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://segmentfault.com/a/1190000017463371",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm发布包教程（二）：发布包"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/tjj3027/article/details/103202637",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm包的发布-官网发布（一）"),n("OutboundLink")],1)])])]),s._v(" "),n("h3",{attrs:{id:"版本号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#版本号"}},[s._v("#")]),s._v(" 版本号")]),s._v(" "),n("p",[s._v("使用NPM下载和发布代码时都会接触到版本号。NPM使用语义版本号来管理代码，这里简单介绍一下。")]),s._v(" "),n("p",[s._v("语义版本号分为"),n("code",[s._v("X.Y.Z")]),s._v("三位，分别代表主版本号、次版本号和补丁版本号。当代码变更时，版本号按以下原则更新。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("+ 如果只是修复bug，需要更新Z位。\n\n+ 如果是新增了功能，但是向下兼容，需要更新Y位。\n\n+ 如果有大变动，向下不兼容，需要更新X位。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("版本号有了这个保证后，在申明三方包依赖时，除了可依赖于一个固定版本号外，还可依赖于某个范围的版本号。")]),s._v(" "),n("p",[s._v("例如"),n("code",[s._v('"argv": "0.0.x"')]),s._v("表示依赖于"),n("code",[s._v("0.0.x")]),s._v("系列的最新版"),n("code",[s._v("argv")]),s._v("。NPM支持的所有版本号范围指定方式可以查看"),n("a",{attrs:{href:"https://npmjs.org/doc/files/package.json.html#dependencies",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"更多功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更多功能"}},[s._v("#")]),s._v(" 更多功能")]),s._v(" "),n("p",[s._v("除了本章介绍的部分外，NPM还提供了很多功能，"),n("code",[s._v("package.json")]),s._v("里也有很多其它有用的字段。除了可以在"),n("a",{attrs:{href:"https://npmjs.org/doc/",target:"_blank",rel:"noopener noreferrer"}},[s._v("npmjs.org/doc/"),n("OutboundLink")],1),s._v("查看官方文档外，这里再介绍一些NPM常用命令。")]),s._v(" "),n("ul",[n("li",[s._v("NPM提供了很多命令，例如"),n("code",[s._v("install")]),s._v("和"),n("code",[s._v("publish")]),s._v("，使用"),n("code",[s._v("npm help")]),s._v("可查看所有命令。")]),s._v(" "),n("li",[s._v("使用"),n("code",[s._v("npm help <command>")]),s._v("可查看某条命令的详细帮助，例如"),n("code",[s._v("npm help install")]),s._v("。")]),s._v(" "),n("li",[s._v("在"),n("code",[s._v("package.json")]),s._v("所在目录下使用"),n("code",[s._v("npm install . -g")]),s._v("可先在本地安装当前命令行程序，可用于发布前的本地测试。")]),s._v(" "),n("li",[s._v("使用"),n("code",[s._v("npm update <package>")]),s._v("可以把当前目录下"),n("code",[s._v("node_modules")]),s._v("子目录里边的对应模块更新至最新版本。")]),s._v(" "),n("li",[s._v("使用"),n("code",[s._v("npm update <package> -g")]),s._v("可以把全局安装的对应命令行程序更新至最新版。")]),s._v(" "),n("li",[s._v("使用"),n("code",[s._v("npm cache clear")]),s._v("可以清空NPM本地缓存，用于对付使用相同版本号发布新版本代码的人。")]),s._v(" "),n("li",[s._v("使用"),n("code",[s._v("npm unpublish <package>@<version>")]),s._v("可以撤销发布自己发布过的某个版本代码。")])]),s._v(" "),n("h2",{attrs:{id:"小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),n("p",[s._v("本章介绍了使用NodeJS编写代码前需要做的准备工作，总结起来有以下几点：")]),s._v(" "),n("ul",[n("li",[s._v("编写代码前先规划好目录结构，才能做到有条不紊。")]),s._v(" "),n("li",[s._v("稍大些的程序可以将代码拆分为多个模块管理，更大些的程序可以使用包来组织模块。")]),s._v(" "),n("li",[s._v("合理使用"),n("code",[s._v("node_modules")]),s._v("和"),n("code",[s._v("NODE_PATH")]),s._v("来解耦包的使用方式和物理路径。")]),s._v(" "),n("li",[s._v("使用NPM加入NodeJS生态圈互通有无。")]),s._v(" "),n("li",[s._v("想到了心仪的包名时请提前在NPM上抢注。")])]),s._v(" "),n("h3",{attrs:{id:"个人测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#个人测试"}},[s._v("#")]),s._v(" 个人测试")]),s._v(" "),n("p",[s._v("个人根据教程发布的测试代码地址："),n("a",{attrs:{href:"https://github.com/giriawsh/publish_test",target:"_blank",rel:"noopener noreferrer"}},[s._v("publish_test"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("NPM包地址："),n("a",{attrs:{href:"https://www.npmjs.com/package/@giria/node-echo",target:"_blank",rel:"noopener noreferrer"}},[s._v("@giria/node-echo"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("安装代码：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("npm i @giria"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("echo "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("使用测试：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("➜  test-for-npm node-echo Hello\nC:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Program Files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("nodejs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("node.exe C:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Program Files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("nodejs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("npm-global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("node_modules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("@giria"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("node-echo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("bin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("node-echo.js Hello\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("第一个为本地node执行地址  第二个为node-cho包安装地址 第三个为原本的参数")]),s._v(" "),n("p",[s._v("（原教程中的argv包join方法会报错，已换成内置的process.argv方法）")])])}),[],!1,null,null,null);a.default=t.exports}}]);